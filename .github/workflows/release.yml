name: Release

on:
  push:
    tags:
      - 'v*' # v1.0.0, v1.1.0 ë“± íƒœê·¸ í‘¸ì‹œ ì‹œ ì‹¤í–‰
      - '*' # ëª¨ë“  íƒœê·¸ í‘¸ì‹œ ì‹œ ì‹¤í–‰ 
  workflow_dispatch:
    inputs:
      tag:
        description: 'Release tag (e.g., v1.6.2)'
        required: true
        type: string 
    
permissions:
  contents: write # GitHub Release ìƒì„± ê¶Œí•œ


env:
  # ğŸ”¥ ê¸°ë³¸ í™˜ê²½
  NODE_ENV: ${{ secrets.NODE_ENV }}
  STATIC_SERVER_ORIGIN: ${{ secrets.STATIC_SERVER_ORIGIN }}
  GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}   # â† ì—¬ê¸°ë¥¼ ì¶”ê°€

  # ë”ë¯¸ ë°ì´í„°ë² ì´ìŠ¤ ê²½ë¡œ ( CI ë¹Œë“œìš© )
  DATABASE_URL: "file:./prisma/loop.db"
  PRISMA_DATABASE_URL: "file:./prisma/loop.db"


  # ğŸ”¥ URL ì„¤ì •
  NEXT_PUBLIC_SHARE_WEB_URL: ${{ secrets.NEXT_PUBLIC_SHARE_WEB_URL }}
  NEXT_PUBLIC_SHARE_API_URL: ${{ secrets.NEXT_PUBLIC_SHARE_API_URL }}

  # ğŸ”¥ ë¡œê¹…
  LOG_LEVEL: ${{ secrets.LOG_LEVEL }}
  DEBUG: ${{ secrets.DEBUG }}
  VERBOSE_LOGGING: ${{ secrets.VERBOSE_LOGGING }}

  # ğŸ”¥ ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§
  ENABLE_PERFORMANCE_TRACKING: ${{ secrets.ENABLE_PERFORMANCE_TRACKING }}
  MEMORY_MONITORING: ${{ secrets.MEMORY_MONITORING }}



  # ğŸ”¥ AI ê¸°ëŠ¥
  AI_ANALYSIS_ENABLED: ${{ secrets.AI_ANALYSIS_ENABLED }}
  MOCK_AI_RESPONSES: ${{ secrets.MOCK_AI_RESPONSES }}

  # ğŸ”¥ ê°œë°œì ë„êµ¬
  REACT_DEVELOPER_TOOLS: ${{ secrets.REACT_DEVELOPER_TOOLS }}
  REDUX_DEVTOOLS: ${{ secrets.REDUX_DEVTOOLS }}

  # ğŸ”¥ Google OAuth
  GOOGLE_CLIENT_ID: ${{ secrets.GOOGLE_CLIENT_ID }}
  GOOGLE_CLIENT_SECRET: ${{ secrets.GOOGLE_CLIENT_SECRET }}
  GOOGLE_API_KEY: ${{ secrets.GOOGLE_API_KEY }}
  GOOGLE_REDIRECT_URI: ${{ secrets.GOOGLE_REDIRECT_URI }}

  # ğŸ”¥ ì•”í˜¸í™”
  ENCRYPT_SNAPSHOT_KEY: ${{ secrets.ENCRYPT_SNAPSHOT_KEY }}

  # ğŸ”¥ Gemini AI
  GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
  GEMINI_MODEL: ${{ secrets.GEMINI_MODEL }}
  NEXT_PUBLIC_GEMINI_API_KEY: ${{ secrets.NEXT_PUBLIC_GEMINI_API_KEY }}
  NEXT_PUBLIC_GEMINI_MODEL: ${{ secrets.NEXT_PUBLIC_GEMINI_MODEL }}
  GEMINI_MAX_TOKENS: ${{ secrets.GEMINI_MAX_TOKENS }}
  GEMINI_TEMPERATURE: ${{ secrets.GEMINI_TEMPERATURE }}

  # ğŸ”¥ Firebase
  FIREBASE_API_KEY: ${{ secrets.FIREBASE_API_KEY }}
  FIRE_AUTH_DOMAIN: ${{ secrets.FIRE_AUTH_DOMAIN }}
  FIRE_PROJECT_ID: ${{ secrets.FIRE_PROJECT_ID }}
  STORAGE_BUCKET: ${{ secrets.STORAGE_BUCKET }}
  MESSAGING_SENDER_ID: ${{ secrets.MESSAGING_SENDER_ID }}
  APP_ID: ${{ secrets.APP_ID }}
  MEASUREMENT_ID: ${{ secrets.MEASUREMENT_ID }}

jobs:
  release-windows-x64:
    runs-on: windows-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
      
      - name: Setup pnpm
        uses: pnpm/action-setup@v4
      
      - name: Get pnpm store directory
        shell: bash
        run: |
          echo "STORE_PATH=$(pnpm store path --silent)" >> $GITHUB_ENV
      
      - name: Setup pnpm cache
        uses: actions/cache@v4
        with:
          path: ${{ env.STORE_PATH }}
          key: ${{ runner.os }}-pnpm-store-${{ hashFiles('**/pnpm-lock.yaml') }}
          restore-keys: |
            ${{ runner.os }}-pnpm-store-
      
      - name: Install dependencies
        run: pnpm install --force
      
      - name: Generate Prisma Client
        run: pnpm exec prisma generate
      
      - name: Verify Prisma Client Generation
        shell: bash
        run: |
          echo "ğŸ” Verifying Prisma client generation..."
          echo "Node version: $(node -v)"
          echo "pnpm version: $(pnpm -v)"
          
          # Prisma ë””ë ‰í† ë¦¬ í™•ì¸
          echo "ğŸ“ Checking Prisma directories..."
          ls -la node_modules/@prisma/ 2>&1 || echo "âš ï¸ @prisma directory not found"
          ls -la node_modules/.prisma/client/ 2>&1 | head -20 || echo "âš ï¸ .prisma/client directory not found"
          
          # @prisma/client ê²½ë¡œ í™•ì¸
          echo "ğŸ”— Resolving @prisma/client path..."
          node -e "try { console.log('Resolved path:', require.resolve('@prisma/client')); } catch (e) { console.error('Cannot resolve:', e.message); process.exit(1); }" || exit 1
          
          # Prisma Client ì„í¬íŠ¸ í…ŒìŠ¤íŠ¸
          echo "âœ“ Testing PrismaClient import..."
          node -e "const { PrismaClient } = require('@prisma/client'); console.log('âœ… PrismaClient type:', typeof PrismaClient); if (typeof PrismaClient !== 'function') { console.error('âŒ PrismaClient is not a function'); process.exit(1); }" || exit 1
          
          echo "âœ… Prisma Client verification passed!"
      
      - name: Build application
        run: pnpm build
      
      - name: Package Windows application
        run: pnpm dist:win --publish never
        env:
          # âš ï¸ GH_TOKENì€ job ë ˆë²¨ì—ì„œ ì´ë¯¸ ì •ì˜ë¨ (L17)
          # electron-builderê°€ ìë™ìœ¼ë¡œ GitHub Releaseì— ì—…ë¡œë“œí•˜ì§€ ì•Šë„ë¡ í•¨
          # softprops/action-gh-releaseì—ì„œë§Œ ì—…ë¡œë“œ ìˆ˜í–‰

          # ğŸ”¥ Windows ì½”ë“œ ì„œëª… (electron-builder v26+ í‘œì¤€ ë°©ì‹)
          CSC_LINK: ${{ secrets.WIN_CSC_LINK }}
          CSC_KEY_PASSWORD: ${{ secrets.WIN_CSC_KEY_PASSWORD }}

          # ğŸ”¥ ê¸°ë³¸ í™˜ê²½ ì„¤ì •
          NODE_ENV: production

          # ğŸ”¥ electron-builder ë””ë²„ê¹…
          DEBUG: electron-builder

          # ğŸ”¥ í¬íŠ¸ ì„¤ì • (CIì—ì„œëŠ” ìë™ í• ë‹¹)
          STATIC_SERVER_ORIGIN: ${{ secrets.STATIC_SERVER_ORIGIN }}

          # ğŸ”¥ URL ì„¤ì • (í”„ë¡œë•ì…˜ìš©)
          NEXT_PUBLIC_SHARE_WEB_URL: ${{ secrets.NEXT_PUBLIC_SHARE_WEB_URL }}
          NEXT_PUBLIC_SHARE_API_URL: ${{ secrets.NEXT_PUBLIC_SHARE_API_URL }}

          # ğŸ”¥ Logger ì„¤ì •
          LOG_LEVEL: ${{ secrets.LOG_LEVEL }}
          VERBOSE_LOGGING: ${{ secrets.VERBOSE_LOGGING }}

          # ğŸ”¥ ë°ì´í„°ë² ì´ìŠ¤ ì„¤ì • (CIìš© ê²½ë¡œë¡œ ë³€ê²½ í•„ìš”)
          DATABASE_URL: "file:./prisma/loop.db"
          PRISMA_DATABASE_URL: "file:./prisma/loop.db"

          # ğŸ”¥ ë³´ì•ˆ ì„¤ì •
          ELECTRON_ENABLE_SECURITY_WARNINGS: ${{ secrets.ELECTRON_ENABLE_SECURITY_WARNINGS }}
          ELECTRON_DISABLE_SECURITY_WARNINGS: ${{ secrets.ELECTRON_DISABLE_SECURITY_WARNINGS }}

          # ğŸ”¥ ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§
          ENABLE_PERFORMANCE_TRACKING: ${{ secrets.ENABLE_PERFORMANCE_TRACKING }}
          MEMORY_MONITORING: ${{ secrets.MEMORY_MONITORING }}

          # ğŸ”¥ í‚¤ë³´ë“œ ëª¨ë‹ˆí„°ë§ ì„¤ì •
          KEYBOARD_MONITORING_ENABLED: ${{ secrets.KEYBOARD_MONITORING_ENABLED }}
          KEYBOARD_DEBUG_MODE: ${{ secrets.KEYBOARD_DEBUG_MODE }}

          # ğŸ”¥ AI/ë¶„ì„ ê¸°ëŠ¥
          AI_ANALYSIS_ENABLED: ${{ secrets.AI_ANALYSIS_ENABLED }}
          MOCK_AI_RESPONSES: ${{ secrets.MOCK_AI_RESPONSES }}

          # ğŸ”¥ ê°œë°œì ë„êµ¬ (í”„ë¡œë•ì…˜ì—ì„œëŠ” false)
          REACT_DEVELOPER_TOOLS: ${{ secrets.REACT_DEVELOPER_TOOLS }}
          REDUX_DEVTOOLS: ${{ secrets.REDUX_DEVTOOLS }}

          # ğŸ”¥ Google OAuth ì„¤ì •
          GOOGLE_CLIENT_ID: ${{ secrets.GOOGLE_CLIENT_ID }}
          GOOGLE_CLIENT_SECRET: ${{ secrets.GOOGLE_CLIENT_SECRET }}
          GOOGLE_API_KEY: ${{ secrets.GOOGLE_API_KEY }}
          GOOGLE_REDIRECT_URI: ${{ secrets.GOOGLE_REDIRECT_URI }}

          # ğŸ”¥ ì•”í˜¸í™” í‚¤
          ENCRYPT_SNAPSHOT_KEY: ${{ secrets.ENCRYPT_SNAPSHOT_KEY }}

          # ğŸ”¥ Gemini AI ì„¤ì •
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
          GEMINI_MODEL: ${{ secrets.GEMINI_MODEL }}
          NEXT_PUBLIC_GEMINI_API_KEY: ${{ secrets.NEXT_PUBLIC_GEMINI_API_KEY }}
          NEXT_PUBLIC_GEMINI_MODEL: ${{ secrets.NEXT_PUBLIC_GEMINI_MODEL }}
          GEMINI_MAX_TOKENS: ${{ secrets.GEMINI_MAX_TOKENS }}
          GEMINI_TEMPERATURE: ${{ secrets.GEMINI_TEMPERATURE }}

          # ğŸ”¥ Firebase ì„¤ì •
          FIREBASE_API_KEY: ${{ secrets.FIREBASE_API_KEY }}
          FIRE_AUTH_DOMAIN: ${{ secrets.FIRE_AUTH_DOMAIN }}
          FIRE_PROJECT_ID: ${{ secrets.FIRE_PROJECT_ID }}
          STORAGE_BUCKET: ${{ secrets.STORAGE_BUCKET }}
          MESSAGING_SENDER_ID: ${{ secrets.MESSAGING_SENDER_ID }}
          APP_ID: ${{ secrets.APP_ID }}
          MEASUREMENT_ID: ${{ secrets.MEASUREMENT_ID }}
      
      - name: Verify Windows Build Artifacts
        shell: bash
        run: |
          echo "ğŸ” Verifying Windows build artifacts..."
          
          # release ë””ë ‰í† ë¦¬ êµ¬ì¡° í™•ì¸
          echo "ğŸ“‚ Release directory contents:"
          ls -lh release/ || echo "âš ï¸ No release directory"
          
          # NSIS ì„¤ì¹˜ íŒŒì¼ í™•ì¸
          if ls release/*.exe 1> /dev/null 2>&1; then
            echo "âœ… Windows installer (.exe) found:"
            ls -lh release/*.exe
            
            # íŒŒì¼ í¬ê¸° í™•ì¸ (10MB ë¯¸ë§Œì´ë©´ ë¬¸ì œì¼ ê°€ëŠ¥ì„±)
            for file in release/*.exe; do
              size=$(stat -f%z "$file" 2>/dev/null || stat -c%s "$file" 2>/dev/null || echo "0")
              size_mb=$((size / 1024 / 1024))
              if [ $size_mb -lt 10 ]; then
                echo "âš ï¸ Warning: $file is only ${size_mb}MB (might be incomplete)"
              else
                echo "âœ… $file size: ${size_mb}MB"
              fi
            done
          else
            echo "âŒ No .exe installer found!"
            exit 1
          fi
          
          # NSIS 7z ì•„ì¹´ì´ë¸Œ í™•ì¸
          if ls release/*.nsis.7z 1> /dev/null 2>&1; then
            echo "âœ… NSIS 7z archive found:"
            ls -lh release/*.nsis.7z
          fi
          
          # Blockmap íŒŒì¼ í™•ì¸
          if ls release/*.blockmap 1> /dev/null 2>&1; then
            echo "âœ… Blockmap files found:"
            ls -lh release/*.blockmap
          fi
          
          # latest.yml í™•ì¸ (electron-updaterìš©)
          if [ -f "release/latest.yml" ]; then
            echo "âœ… latest.yml found:"
            cat release/latest.yml
          else
            echo "âš ï¸ latest.yml not found (auto-update may not work)"
          fi
      
      - name: Upload Windows x64 artifacts
        uses: actions/upload-artifact@v4
        with:
          name: Loop-Windows-x64
          path: |
            release/*.exe
            release/*.nsis.7z
            release/*.exe.blockmap
            release/latest.yml
          retention-days: 7

  release-windows-arm64:
    runs-on: windows-11-arm
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
      
      - name: Setup pnpm
        uses: pnpm/action-setup@v4
      
      - name: Get pnpm store directory
        shell: bash
        run: |
          echo "STORE_PATH=$(pnpm store path --silent)" >> $GITHUB_ENV
      
      - name: Setup pnpm cache
        uses: actions/cache@v4
        with:
          path: ${{ env.STORE_PATH }}
          key: ${{ runner.os }}-pnpm-store-${{ hashFiles('**/pnpm-lock.yaml') }}
          restore-keys: |
            ${{ runner.os }}-pnpm-store-
      
      - name: Install dependencies
        run: pnpm install --force
      
      - name: Generate Prisma Client
        run: pnpm exec prisma generate
      
      - name: Verify Prisma Client Generation
        shell: bash
        run: |
          echo "ğŸ” Verifying Prisma client generation..."
          echo "Node version: $(node -v)"
          echo "pnpm version: $(pnpm -v)"
          
          # Prisma ë””ë ‰í† ë¦¬ í™•ì¸
          echo "ğŸ“ Checking Prisma directories..."
          ls -la node_modules/@prisma/ 2>&1 || echo "âš ï¸ @prisma directory not found"
          ls -la node_modules/.prisma/client/ 2>&1 | head -20 || echo "âš ï¸ .prisma/client directory not found"
          
          # @prisma/client ê²½ë¡œ í™•ì¸
          echo "ğŸ”— Resolving @prisma/client path..."
          node -e "try { console.log('Resolved path:', require.resolve('@prisma/client')); } catch (e) { console.error('Cannot resolve:', e.message); process.exit(1); }" || exit 1
          
          # Prisma Client ì„í¬íŠ¸ í…ŒìŠ¤íŠ¸
          echo "âœ“ Testing PrismaClient import..."
          node -e "const { PrismaClient } = require('@prisma/client'); console.log('âœ… PrismaClient type:', typeof PrismaClient); if (typeof PrismaClient !== 'function') { console.error('âŒ PrismaClient is not a function'); process.exit(1); }" || exit 1
          
          echo "âœ… Prisma Client verification passed!"
      
      - name: Build application
        run: pnpm build
      
      - name: Package Windows ARM64 application
        run: pnpm dist:win --publish never
        env:
          # âš ï¸ GH_TOKENì€ job ë ˆë²¨ì—ì„œ ì´ë¯¸ ì •ì˜ë¨ (L17)
          # electron-builderê°€ ìë™ìœ¼ë¡œ GitHub Releaseì— ì—…ë¡œë“œí•˜ì§€ ì•Šë„ë¡ í•¨
          # softprops/action-gh-releaseì—ì„œë§Œ ì—…ë¡œë“œ ìˆ˜í–‰

          # ğŸ”¥ Windows ì½”ë“œ ì„œëª… (electron-builder v26+ í‘œì¤€ ë°©ì‹)
          CSC_LINK: ${{ secrets.WIN_CSC_LINK }}
          CSC_KEY_PASSWORD: ${{ secrets.WIN_CSC_KEY_PASSWORD }}

          # ğŸ”¥ ê¸°ë³¸ í™˜ê²½ ì„¤ì •
          NODE_ENV: production

          # ğŸ”¥ electron-builder ë””ë²„ê¹…
          DEBUG: electron-builder

          # ğŸ”¥ í¬íŠ¸ ì„¤ì • (CIì—ì„œëŠ” ìë™ í• ë‹¹)
          STATIC_SERVER_ORIGIN: ${{ secrets.STATIC_SERVER_ORIGIN }}

          # ğŸ”¥ URL ì„¤ì • (í”„ë¡œë•ì…˜ìš©)
          NEXT_PUBLIC_SHARE_WEB_URL: ${{ secrets.NEXT_PUBLIC_SHARE_WEB_URL }}
          NEXT_PUBLIC_SHARE_API_URL: ${{ secrets.NEXT_PUBLIC_SHARE_API_URL }}

          # ğŸ”¥ Logger ì„¤ì •
          LOG_LEVEL: ${{ secrets.LOG_LEVEL }}
          VERBOSE_LOGGING: ${{ secrets.VERBOSE_LOGGING }}



          # ğŸ”¥ ë³´ì•ˆ ì„¤ì •
          ELECTRON_ENABLE_SECURITY_WARNINGS: ${{ secrets.ELECTRON_ENABLE_SECURITY_WARNINGS }}
          ELECTRON_DISABLE_SECURITY_WARNINGS: ${{ secrets.ELECTRON_DISABLE_SECURITY_WARNINGS }}

          # ğŸ”¥ ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§
          ENABLE_PERFORMANCE_TRACKING: ${{ secrets.ENABLE_PERFORMANCE_TRACKING }}
          MEMORY_MONITORING: ${{ secrets.MEMORY_MONITORING }}

          # ğŸ”¥ í‚¤ë³´ë“œ ëª¨ë‹ˆí„°ë§ ì„¤ì •
          KEYBOARD_MONITORING_ENABLED: ${{ secrets.KEYBOARD_MONITORING_ENABLED }}
          KEYBOARD_DEBUG_MODE: ${{ secrets.KEYBOARD_DEBUG_MODE }}

          # ğŸ”¥ AI/ë¶„ì„ ê¸°ëŠ¥
          AI_ANALYSIS_ENABLED: ${{ secrets.AI_ANALYSIS_ENABLED }}
          MOCK_AI_RESPONSES: ${{ secrets.MOCK_AI_RESPONSES }}

          # ğŸ”¥ ê°œë°œì ë„êµ¬ (í”„ë¡œë•ì…˜ì—ì„œëŠ” false)
          REACT_DEVELOPER_TOOLS: ${{ secrets.REACT_DEVELOPER_TOOLS }}
          REDUX_DEVTOOLS: ${{ secrets.REDUX_DEVTOOLS }}

          # ğŸ”¥ Google OAuth ì„¤ì •
          GOOGLE_CLIENT_ID: ${{ secrets.GOOGLE_CLIENT_ID }}
          GOOGLE_CLIENT_SECRET: ${{ secrets.GOOGLE_CLIENT_SECRET }}
          GOOGLE_API_KEY: ${{ secrets.GOOGLE_API_KEY }}
          GOOGLE_REDIRECT_URI: ${{ secrets.GOOGLE_REDIRECT_URI }}

          # ğŸ”¥ ì•”í˜¸í™” í‚¤
          ENCRYPT_SNAPSHOT_KEY: ${{ secrets.ENCRYPT_SNAPSHOT_KEY }}

          # ğŸ”¥ Gemini AI ì„¤ì •
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
          GEMINI_MODEL: ${{ secrets.GEMINI_MODEL }}
          NEXT_PUBLIC_GEMINI_API_KEY: ${{ secrets.NEXT_PUBLIC_GEMINI_API_KEY }}
          NEXT_PUBLIC_GEMINI_MODEL: ${{ secrets.NEXT_PUBLIC_GEMINI_MODEL }}
          GEMINI_MAX_TOKENS: ${{ secrets.GEMINI_MAX_TOKENS }}
          GEMINI_TEMPERATURE: ${{ secrets.GEMINI_TEMPERATURE }}

          # ğŸ”¥ Firebase ì„¤ì •
          FIREBASE_API_KEY: ${{ secrets.FIREBASE_API_KEY }}
          FIRE_AUTH_DOMAIN: ${{ secrets.FIRE_AUTH_DOMAIN }}
          FIRE_PROJECT_ID: ${{ secrets.FIRE_PROJECT_ID }}
          STORAGE_BUCKET: ${{ secrets.STORAGE_BUCKET }}
          MESSAGING_SENDER_ID: ${{ secrets.MESSAGING_SENDER_ID }}
          APP_ID: ${{ secrets.APP_ID }}
          MEASUREMENT_ID: ${{ secrets.MEASUREMENT_ID }}
      
      - name: Verify Windows ARM64 Build Artifacts
        shell: bash
        run: |
          echo "ğŸ” Verifying Windows ARM64 build artifacts..."
          
          # release ë””ë ‰í† ë¦¬ êµ¬ì¡° í™•ì¸
          echo "ğŸ“‚ Release directory contents:"
          ls -lh release/ || echo "âš ï¸ No release directory"
          
          # NSIS ì„¤ì¹˜ íŒŒì¼ í™•ì¸
          if ls release/*.exe 1> /dev/null 2>&1; then
            echo "âœ… Windows ARM64 installer (.exe) found:"
            ls -lh release/*.exe
            
            # íŒŒì¼ í¬ê¸° í™•ì¸ (10MB ë¯¸ë§Œì´ë©´ ë¬¸ì œì¼ ê°€ëŠ¥ì„±)
            for file in release/*.exe; do
              size=$(stat -f%z "$file" 2>/dev/null || stat -c%s "$file" 2>/dev/null || echo "0")
              size_mb=$((size / 1024 / 1024))
              if [ $size_mb -lt 10 ]; then
                echo "âš ï¸ Warning: $file is only ${size_mb}MB (might be incomplete)"
              else
                echo "âœ… $file size: ${size_mb}MB"
              fi
            done
          else
            echo "âŒ No .exe installer found!"
            exit 1
          fi
          
          # NSIS 7z ì•„ì¹´ì´ë¸Œ í™•ì¸
          if ls release/*.nsis.7z 1> /dev/null 2>&1; then
            echo "âœ… NSIS 7z archive found:"
            ls -lh release/*.nsis.7z
          fi
          
          # Blockmap íŒŒì¼ í™•ì¸
          if ls release/*.blockmap 1> /dev/null 2>&1; then
            echo "âœ… Blockmap files found:"
            ls -lh release/*.blockmap
          fi
          
          # latest.yml í™•ì¸ (electron-updaterìš©)
          if [ -f "release/latest.yml" ]; then
            echo "âœ… latest.yml found:"
            cat release/latest.yml
          else
            echo "âš ï¸ latest.yml not found (auto-update may not work)"
          fi
      
      - name: Upload Windows ARM64 artifacts
        uses: actions/upload-artifact@v4
        with:
          name: Loop-Windows-ARM64
          path: |
            release/*.exe
            release/*.nsis.7z
            release/*.exe.blockmap
            release/latest.yml
          retention-days: 7

  # ğŸ”¥ ìµœì¢… Release ì—…ë¡œë“œ (Windows x64/ARM64 ë§Œ CIì—ì„œ ì²˜ë¦¬)
  upload-release:
    name: Upload Windows to GitHub Release
    runs-on: ubuntu-latest
    needs: [release-windows-x64, release-windows-arm64]
    if: startsWith(github.ref, 'refs/tags/') || github.event_name == 'workflow_dispatch'
    permissions:
      contents: write
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      
      - name: Set tag from input or ref
        id: set_tag
        run: |
          if [ "${{ github.event_name }}" == "workflow_dispatch" ]; then
            echo "tag=${{ github.event.inputs.tag }}" >> $GITHUB_OUTPUT
          else
            echo "tag=${GITHUB_REF#refs/tags/}" >> $GITHUB_OUTPUT
          fi
      
      - name: Download Windows x64 artifacts
        uses: actions/download-artifact@v4
        with:
          name: Loop-Windows-x64
          path: ./artifacts/windows-x64
      
      - name: Download Windows ARM64 artifacts
        uses: actions/download-artifact@v4
        with:
          name: Loop-Windows-ARM64
          path: ./artifacts/windows-arm64
      
      - name: List all artifacts
        run: |
          echo "ğŸ“¦ Windows x64 artifacts:"
          ls -lh ./artifacts/windows-x64/release/ 2>/dev/null || echo "No artifacts"
          echo ""
          echo "ğŸ“¦ Windows ARM64 artifacts:"
          ls -lh ./artifacts/windows-arm64/release/ 2>/dev/null || echo "No artifacts"
      
      - name: Create Release with Windows artifacts
        uses: softprops/action-gh-release@v2
        with:
          tag_name: ${{ steps.set_tag.outputs.tag }}
          files: |
            ./artifacts/windows-x64/release/*
            ./artifacts/windows-arm64/release/*
          draft: false
          prerelease: false
          make_latest: true
          generate_release_notes: true
          fail_on_unmatched_files: false
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      
      - name: Release Upload Complete
        run: |
          echo "âœ… Windows Release created successfully!"
          echo "Tag: ${{ steps.set_tag.outputs.tag }}"
          echo "Tag: ${{ github.ref_name }}"
          echo "âš ï¸ NOTE: macOS artifacts ì¶”ê°€í•˜ë ¤ë©´ 'pnpm dist:mac' ì‹¤í–‰ í›„"
          echo "release/ í´ë”ì˜ íŒŒì¼ë“¤ì„ GitHub Releaseì— ìˆ˜ë™ ì—…ë¡œë“œí•˜ì„¸ìš”"
          echo "URL: https://github.com/${{ github.repository }}/releases/tag/${{ github.ref_name }}"
